<!-- $Id: pmdbtool.html,v 1.5 2003/01/24 03:12:42 terescoj Exp $ -->
<TITLE>PMDBtool</TITLE>
<H1>PMDBtool</H1>

The <I>PMDBtool</I> program provides simple access to many of the
functionalities of the <A HREF="pmdb_manual">Parallel Mesh
Database</A> without writing a whole program for each little task.
<P>

PMDBtool takes one command-line argument, the name of a command script
file.  It parses the command file and does things like loading and
paritioning meshes, load balancing, and computing our metric
statistics.

<h3>PMDBtool commands</H3>

These commands can be placed in a script file which is given on the
command line.  Text on a line after a <TT>#</TT> character is treated
as a comment.<P>

<PRE>
- trace
- trace &lt;bool_val&gt;
</PRE>

Turn on or off trace output, depending on the boolean argument.  A
missing argument is taken to mean turn on tracing.

<PRE>
- compress &lt;level&gt;
</PRE>

Set the output compression level.  Valid compression levels are
<UL>
<LI><CODE>none</CODE>, for uncompressed output,
<LI><CODE>compress</CODE>, for compression with UNIX compress
<CODE>(.Z)</CODE>
<LI><CODE>gzip</CODE>, for compression with gzip <CODE>(.gz)</CODE>
<LI><CODE>gzip9</CODE>, for compression with gzip -9
<CODE>(.gz)</CODE>
</UL>

The default compression is <CODE>gzip</CODE>.

<PRE>
- indir "path"
- outdir "path"
</PRE>

Sets default input and output directories to the given string.  The
path string must be quoted.  Any input or output files which are given
on subsequent lines and which do not have a directory included in
their filename will have this path prepended to them before opening.
These can be issued multiple times in an execution of the program to
change directories on the fly.

<PRE>
- model "file"
</PRE>

Loads the model file in <CODE>"file.smd"</CODE>.  This should be done
first, just as it usually is done in a Mesh Database/PMDB application.
This command will call <CODE>GM_createFromFile()</CODE> to load the model file.

<PRE>
- part &lt;type&gt; "file"
</PRE>

Load <CODE>"file.sms"</CODE> file and partition onto all the
processors.  <CODE>&lt;type&gt;</CODE> can be inertial or orthogonal.
This command will call <CODE>pmdb_inertia_rb()</CODE> or
<CODE>pmdb_ortho_rb()</CODE>.

<PRE>
- read_sms "file"
</PRE>

Load saved PMDB files in <CODE>"file.procid.sms"</CODE> and
<CODE>"file.procid.pmdb"</CODE>.  This command will call
<CODE>pmdb_read_msh_par()</CODE>.

<PRE>
- read_split_sms "file"
</PRE>

Load split mesh files in <CODE>"file.procid.sms"</CODE>.  This command
will call <CODE>pmdb_load_split_sms()</CODE>.  The interprocessor
links normally stored in the <CODE>.pmdb</CODE> files are generated by
PMDB.

<PRE>
- write_sms "file"
</PRE>

Write PMDB files <CODE>"file.procid.sms"</CODE> and
<CODE>"file.procid.pmdb"</CODE>.  This command will call
<CODE>pmdb_write_msh_par()</CODE>.

<PRE>
- metrics "prefix" "infix"
</PRE>

Print metric information about the current mesh and partition.  This
results in a call to <CODE>pmdb_metrics();</CODE> with the args here
passed as the prefix and infix strings.

<PRE>
- loads max/avg/local/global
</PRE>

Print values of load (possibly weighted) and the number of regions in
the current mesh and partition.  Any combination of <code>max</code>,
<code>avg</code>, <code>local</code>, and <code>global</code> can be
displayed, with multiple values separated by spaces.  <code>max</code>
prints the maximum values on any processors, <code>avg</code> the
average values, <code>local</code> the local values from each
processor, and <code>global</code> the overall totals.

<PRE>
- si max/avg/local/global
</PRE>

Compute and print values of surface index metrics in the current mesh
and partition.  Any combination of <code>max</code>, <code>avg</code>,
<code>local</code>, and <code>global</code> can be displayed, with
multiple values separated by spaces.  <code>max</code> prints the
maximum value on any processor (MLSI), <code>avg</code> the average
value, <code>local</code> the local value from each processor, and
<code>global</code> the overall total (GSI).

<PRE>
- disconn max/avg/local ent_type
</PRE>

Compute and print the number of disjoint connected components in the
current mesh and partition.  Any combination of <code>max</code>,
<code>avg</code>, and <code>local</code> can be displayed, with
multiple values separated by spaces.  <code>max</code> prints the
maximum number of components on any processor, <code>avg</code> the
average count, and <code>local</code> the local count from each
processor.  <code>ent_type</code> is the type of entity adjacency used
for the calculation, which could be <code>face</code>,
<code>edge</code>, or <code>vertex</code>.

<PRE>
- adjacency max/avg/local
</PRE>

Compute and print the number and percentage of partition adjacencies
current mesh and partition.  Any combination of <code>max</code>,
<code>avg</code>, and <code>local</code> can be displayed, with
multiple values separated by spaces.  <code>max</code> prints the
maximum number of processors adjacent to any processor,
<code>avg</code> the average count, and <code>local</code> the local
adjacency count from each processor.

<PRE>
- duplicates ent_type
</PRE>

Print the number of duplicated partition boundary entities in the
current mesh and partition.  <code>ent_type</code> is the type of
entity, which could be <code>face</code>, <code>edge</code>, or
<code>vertex</code>.

<PRE>
- comm_matrix
</PRE>

Compute and print the communication matrix for the
current mesh and partition.

<PRE>
- int_matrix
</PRE>

Compute and print the interface matrix for the current mesh and
partition.

<PRE>
- centroids "file"
</PRE>

Write the centroids of all mesh regions on each processor <I>i</I> in
a file <code>file.i.cent</code>.

<PRE>
- dx &lt;dx_opts&gt; "file"
</PRE>

Write Data Explorer files which represent the currently loaded
mesh. <CODE>&lt;dx_opts&gt;</CODE> can include the tokens
<CODE>color</CODE>, <CODE>bw</CODE>, <CODE>surface</CODE>,
<CODE>3d</CODE>, or <CODE>2d</CODE>.  The defaults are
<CODE>color</CODE> and <CODE>3d</CODE>.  Depending on the options
given, one of the following will be called:
<CODE>pmdb_write_dx()</CODE>, <CODE>pmdb_write_bw_dx()</CODE>,
<CODE>pmdb_write_2d_dx()</CODE>, <CODE>pmdb_write_2d_bw_dx()</CODE>,
<CODE>pmdb_write_sur_dx()</CODE>, or
<CODE>pmdb_write_bw_sur_dx()</CODE>.

<PRE>
- refine sphere (x,y,z) r
- refine box (x1,y1,z1) (x2,y2,z2)
</PRE>

Call the refdref library to refine at all vertices which fall within
the given region.  For a sphere refinement, (x,y,z) is the center of
the sphere and r is the radius.  For a box refinement, the 2 points
given are the opposite corners of a box in which refinement is to take
place.  <I>The files <CODE>refdref.inp</CODE>, which gives the
parameters to the refinement/derefinement library, and the file
<I>meshname</I><CODE>.xmt_txt</CODE>, which is the Parasolid model
description file, must exist in the working directory to use the
refinement operators.</I>

<PRE>
- refine percentage pct
</PRE>

Call the refdref library to mark for refinement a percentage of all
vertices in the mesh.  pct should be a value between 0 and 1 to
indicate what portion of vertices should be marked for refinement.
Note that this does not mean an increase by a factor of pct - in fact,
the growth in mesh size will be several times greater.

<PRE>
- coarsen sphere (x,y,z) r
- coarsen box (x1,y1,z1) (x2,y2,z2)
</PRE>

Call the refdref library to mark for coarsening all vertices which
fall within the given region.  For a sphere refinement, (x,y,z) is the
center of the sphere and r is the radius.  For a box refinement, the 2
points given are the opposite corners of a box in which refinement is
to take place.

<PRE>
- weight sphere (x,y,z) r n
- weight box (x1,y1,z1) (x2,y2,z2) n
</PRE>

Set the weights for all elements in the given region to
<code>n</code>.  These weights are used rather than the region count
to determine workloads during load balancing.  Again, for a sphere
refinement, (x,y,z) is the center of the sphere and r is the radius.
For a box refinement, the 2 points given are the opposite corners of a
box in which refinement is to take place.

<PRE>
- checklinks
</PRE>

Call the PMDB link validity-checking routines.
<CODE>pmdb_check_links()</CODE> is called.

<PRE>
- checkmesh
</PRE>

Call the MeshTools mesh validity-checking routines.
<CODE>M_checkAdj()</CODE> is called.

<P>
Load balancing parameter setting:
<P>
<PRE>
- PMDB_LB_SEL_METHOD        &lt;method&gt;
- PMDB_LB_MAX_ITER          &lt;max_iter&gt;
- PMDB_LB_MAX_INTERNAL_ITER &lt;max_iter&gt;
- PMDB_LB_DEBUG_LEVEL       &lt;level&gt;
- PMDB_LB_TOLERANCE         &lt;tol&gt;
- PMDB_LB_PRINT_MIGSTATS    &lt;boolean&gt;
- PMDB_LB_PRINT_ITBTIMES    &lt;boolean&gt;
- PMDB_LB_PRINT_ZOLTANTIMES &lt;boolean&gt;
</PRE>

These commands set various paramters for PMDB's Iterative Tree
Balancing algorithm or PMDB Zoltan interface.  Each of these results
in a call to <CODE>pmdb_set_load_balance_params()</CODE>.  Valid
values for each are described in the <A HREF="pmdb_manual">PMDB User's
Manual</A>.

<PRE>
- load_balance
</PRE>

Do Iterative Tree Balancing based on the previously set load balancing
paramters.  This command will result in a call to
<CODE>pmdb_load_balance()</CODE>.

<PRE>
- repartition
</PRE>

Call Hugues DeCougny's parallel repartitioning function.  This does a
global, parallel repartitioning using Inertial Recursive Bisection.

<PRE>
- parmetis type
</PRE>

Call one of the ParMetis parallel repartitioning functions.  The
argument "type" specifies which of the methods to use.  See the
<TT>scorec2metis</TT> documentation for details.

<PRE>
- zoltan "param" "value"
- zoltan
</PRE>

These use PMDB's interface to the <A
HREF="http://www.cs.sandia.gov/Zoltan/">Zoltan Dynamic Load Balancing
Library</A>.  WIth two string arguments, this command sets the Zoltan
parameter "param" to the value specified by "value".  With no
arguments, this command performs a Zoltan load balancing and PMDB
migration to achieve the new distribution.  By default, the PMDB
Zoltan interface uses Octree Load Balancing with Hilbert indexing and
a maintained octree structure.

<PRE>
- migstats [ reset | print | output filename ]
</PRE>

<code>migstats reset</code> resets the PMDB internal migration stats
counters.  It can be called before a refinement, load-balance, or
other operation which may include a migration step to obtain detailed
information about the time spent and number of messages transmitted
during migration..  <code>migstats print</code> will print out the
stats since the last <code>migstats reset</code> call.  <code>migstats
output filename</code> will write the stats since the last reset call
to a file <code>filename</code>.

<PRE>
- modeler [ shapes | parasolid | smd | null]
</PRE>

Select which modeler you wish to use.  <code>smd</code> and
<code>null</code> are always available, but provide limited or no real
information, respectively.  The others require commercial modelers to
be linked, and are likely to be unavailable in many circumstances.

<PRE>
- sleep seconds
</PRE>

Put the process to sleep for <code>seconds</code> seconds.  This is
useful to attach a debugger to a process started in a parallel
environment.

<PRE>
- echo [ all | pid | master ] "message"
</PRE>

Echo a message to standard output.  The second argument indicates
which processes are to perform the echo.  <code>all</code> means all
processes should print, <code>master</code> means only the master
process, and a process ID number means just that process.  A missing
second argument indicates that the message should be printed by only
the master process.

<H3>Enhancements</H3>

I'd like to add ability to do some more simple refinements and maybe a
few of the other PMDB operations I have not yet implemented in
PMDBtool.  Suggestions are welcome.<P>

<HR>
<ADDRESS>
E-mail domain: cs.williams.edu, username: terescoj --
Thu Jan 23 22:12:23 EST 2003
</ADDRESS>
